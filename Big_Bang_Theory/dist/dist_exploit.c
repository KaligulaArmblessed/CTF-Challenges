#define _GNU_SOURCE
#include <errno.h>
#include <fcntl.h>
#include <pthread.h>
#include <sched.h>
#include <signal.h>
#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <string.h>
#include <sys/ioctl.h>
#include <sys/types.h>
#include <sys/prctl.h>
#include <sys/mman.h>
#include <sys/wait.h>

#define ROSES_ARE_RED_WIRES_ARE_TOO    0xc020ca00 
#define BOOMERS_BEWARE                 0xc020ca01 
#define SNIP_HAPPENS                   0xc020ca02 
#define JAMES_BOMB                     0xc020ca03
#define THIS_IS_FINE                   0xc020ca04 
#define BOMB_VOYAGE                    0xc020ca05 

struct req {
    uint64_t idx;
    uint64_t size;
    uint64_t addr;
    uint64_t signature; 
};

// Module functions
int do_create(uint64_t * size, char * addr) {
    struct req req; 
    req.idx = 0; 
    req.size = (uint64_t) size;
    req.addr = (uint64_t) addr; 
    req.signature = 0x0; 
    
    if (ioctl(fd, ROSES_ARE_RED_WIRES_ARE_TOO, &req) < 0) {
        perror("[!] Create failed");
        return -1;
    }
    printf("[+] Performed create\n");
    return 0;
}

int do_read(uint64_t idx, char * addr, char * signature) {
    struct req req; 
    req.idx = idx; 
    req.size = 0x0;
    req.addr = (uint64_t) addr; 
    req.signature = (uint64_t) signature; 
    
    if (ioctl(fd, BOOMERS_BEWARE, &req) < 0) {
        perror("[!] Read failed");
        return -1;
    }
    printf("[+] Performed read\n");
    return 0;
}

int do_delete(uint64_t idx) {
    struct req req; 
    req.idx = idx; 
    req.size = 0x0;
    req.addr = 0x0; 
    req.signature = 0x0; 
    
    if (ioctl(fd, SNIP_HAPPENS, &req) < 0) {
        perror("[!] Delete failed");
        return -1;
    }
    printf("[+] Performed delete\n");
    return 0;
}

int do_secret(uint64_t idx) {
    struct req req; 
    req.idx = idx; 
    req.size = 0x0;
    req.addr = 0x0; 
    req.signature = 0x0; 
    
    if (ioctl(fd, JAMES_BOMB, &req) < 0) {
        perror("[!] Secret failed");
        return -1;
    }
    printf("[+] Triggered secret\n");
    return 0;
}


int do_size(uint64_t idx, uint64_t * size, char * addr) {
    struct req req; 
    req.idx = idx; 
    req.size = (uint64_t) size;
    req.addr = (uint64_t) addr; 
    req.signature = 0x0; 
    
    if (ioctl(fd, THIS_IS_FINE, &req) < 0) {
        perror("[!] Change size failed");
        return -1;
    }
    printf("[+] Changed size\n");
    return 0;
}

int do_write(uint64_t idx, char * addr) {
    struct req req; 
    req.idx = idx; 
    req.size = 0x0;
    req.addr = (uint64_t) addr; 
    req.signature = 0x0; 
    
    if (ioctl(fd, BOMB_VOYAGE, &req) < 0) {
        perror("[!] Write failed");
        return -1;
    }
    printf("[+] Performed write\n");
    return 0;
}

int main(void) {

    // Hehehehe put your exploit here :>
    
    return 0; 
}
